<!DOCTYPE html>
<html>

  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="theme-color" content="#22365A">
	<title>7.7 模块划分与软件设计技术 - Niffler</title>

	<link rel="shortcut icon" href="/styles/images/logo.png">
	<link rel="icon" href="/styles/images/logo.png">

	<link rel="stylesheet" href="/styles/css/index.css">
	<link rel="stylesheet" href="/styles/css/fontawesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="/styles/css/syntax.css">
	<link rel="canonical" href="/7.%E8%AE%BE%E8%AE%A1%E8%AF%B4%E6%98%8E%E4%B9%A6/7.7.%E6%A8%A1%E5%9D%97%E5%88%92%E5%88%86%E4%B8%8E%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E6%8A%80%E6%9C%AF/">
	<link rel="alternate" type="application/rss+xml" title="Niffler" href="/feed.xml">
	
	<meta name="keywords" content="7.7 模块划分与软件设计技术, Niffler, Niffler">
	<meta name="description" content="Niffler">

	<script src="/styles/js/jquery.min.js"></script>
	<!--[if lt IE 9]>
    	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  	<![endif]-->
  	<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "//hm.baidu.com/hm.js?94be4b0f9fc5d94cc0d0415ea6761ae9";
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
	</script>
  	<style type="text/css">
	  	.docs-content{
	  		margin-bottom: 10px;
	  	}
  	</style>
</head>

  <body class="index">

    <header class="navbar navbar-inverse navbar-fixed-top docs-nav" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">
        <img src="/styles/images/logo-header.png">
      </a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">    
        <li>
          <a href="/">圈多多</a>
        </li>
        <!-- <li>
          <a href="/categories/">大类分解</a>
        </li>
        <li>
          <a href="/tag">小类内聚</a>
        </li> -->
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://github.com/sysu-swsad-team">Github</a></li>
       
      </ul>
    </nav>
  </div>
</header>
    <div class="docs-header" id="content">
  <div class="container">
  	
  		<!--
		    <h1>7.7 模块划分与软件设计技术</h1>
		    <p>Post on May 22, 2019 by <a href="/about">sysu-swsad-team</a></p>
		-->
		    <h1>Niffler</h1>
    
  </div>
</div>
    
      
<div class="banner">
  <div class="container">
  	
    	<a href="/categories/#7.设计说明书-ref">7.设计说明书</a>	/
      <!-- <a href="/tag/#-ref"></a> -->
      <span>7.7 模块划分与软件设计技术</span>
    
  </div>
</div>

    

    <div class="container docs-container">
  <div class="row">
    <div class="col-md-3">
      <div class="sidebar hidden-print" role="complementary">
        <div id="navigation">
  <h1>目录</h1>
  <ul class="nav sidenav">
  </ul>
  <!-- <div style="height: 200px;width: 200px;">
    <script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=&amp;m=0&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33" async="async"> 
    </script>
  </div> -->
</div>

 
      </div>
    </div>
    <div class="col-md-9" role="main">
      <div class="panel docs-content">
        <div class="wrapper">
            <header class="post-header">
              <h1 class="post-title">7.7 模块划分与软件设计技术</h1>
              <!--
                <p class="post-meta">May 22, 2019 • sysu-swsad-team</p>
              -->
              <!-- <div class="meta">Posted on <span class="postdate">May 22, 2019</span> By <a target="_blank" href="https://sysu-swsad-team.github.io/">sysu-swsad-team</a></div> -->
              <div class="meta">Posted By <a target="_blank" href="https://github.com/sysu-swsad-team">sysu-swsad-team</a></div>
              <br />
            </header>
            <article class="post-content">
              <ul id="markdown-toc">
  <li><a href="#前端技术应用" id="markdown-toc-前端技术应用">前端技术应用</a>    <ul>
      <li><a href="#vuejs-组件化应用构建" id="markdown-toc-vuejs-组件化应用构建">Vue.js 组件化应用构建</a></li>
      <li><a href="#vuex-状态管理" id="markdown-toc-vuex-状态管理">Vuex 状态管理</a></li>
      <li><a href="#element-ui-组件库" id="markdown-toc-element-ui-组件库">Element-UI 组件库</a></li>
      <li><a href="#webpack" id="markdown-toc-webpack">webpack</a></li>
      <li><a href="#前端文件结构" id="markdown-toc-前端文件结构">前端文件结构</a></li>
    </ul>
  </li>
  <li><a href="#后端设计" id="markdown-toc-后端设计">后端设计</a>    <ul>
      <li><a href="#模块划分" id="markdown-toc-模块划分">模块划分</a></li>
      <li><a href="#软件设计技术" id="markdown-toc-软件设计技术">软件设计技术</a>        <ul>
          <li><a href="#命令模式" id="markdown-toc-命令模式">命令模式</a></li>
          <li><a href="#观察者模式" id="markdown-toc-观察者模式">观察者模式</a></li>
          <li><a href="#restful-设计" id="markdown-toc-restful-设计">RESTful 设计</a></li>
          <li><a href="#面向对象设计" id="markdown-toc-面向对象设计">面向对象设计</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="前端技术应用">前端技术应用</h2>

<p>在前端我们使用了我们将用到下面几个框架与工具：</p>

<ul>
  <li><a href="https://cn.vuejs.org/">Vue.js</a></li>
  <li><a href="https://vuex.vuejs.org/zh/">Vuex</a></li>
  <li><a href="https://element.eleme.cn/">Element-UI</a></li>
  <li><a href="https://webpack.js.org/">webpack</a></li>
</ul>

<h3 id="vuejs-组件化应用构建">Vue.js 组件化应用构建</h3>

<p>我们选择 Vue.js 作为我们前端开发的主要框架。Vue.js 是一套构建用户界面的渐进式框架，它只关注视图层，采用自底向上增量开发的设计，目标是通过尽可能简单的 API 实现响应的数据绑定和组合的试图组件，并且 Vue 学习起来非常简单。</p>

<p>组件系统是 Vue 的一个重要概念，因为它是一种抽象，允许我们使用小型、独立和通常可复用的组件构建大型应用。跟大多数应用界面一样，在我们的前端应用界面系统可以抽象成下面的一个组件树，Vue 的组件化特性非常适合我们的应用构建。</p>

<p><img src="/styles/images/7.7/components.png" alt="components" /></p>

<p>我们利用 Vue 的组件化特性，将前端界面划分为组件，比如登录/注册界面是一个组件，它又包含登录/注册的子组件。每个组件分文件管理，组件化构建应用可以让我们方便地复用组件。</p>

<p>比如在 Login.vue 里，引用 LoginForm.vue 组件和 RegisterForm.vue 组件</p>

<div class="language-vue highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"root"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"App"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"Panel FormPanel"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;template</span> <span class="na">v-if=</span><span class="s">"signIn"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;h2&gt;</span>NIFFLER<span class="nt">&lt;/h2&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"Social"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;p</span> <span class="na">id=</span><span class="s">"niffler-desc"</span><span class="nt">&gt;</span>一个可以赚闲钱的 APP<span class="nt">&lt;/p&gt;</span>
          <span class="nt">&lt;LoginForm</span> <span class="na">class=</span><span class="s">"sign-in-out-form"</span><span class="nt">&gt;&lt;/LoginForm&gt;</span>
        <span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>
        <span class="nt">&lt;</span><span class="k">template</span> <span class="na">v-else</span><span class="nt">&gt;</span>
          <span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">"signup-title"</span><span class="nt">&gt;</span>SIGN UP<span class="nt">&lt;/h2&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"Social"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;RegisterForm</span> <span class="na">class=</span><span class="s">"sign-in-out-form"</span><span class="nt">&gt;&lt;/RegisterForm&gt;</span>
        <span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      ...
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/template&gt;</span>

<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>
<span class="k">import</span> <span class="nx">LoginForm</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./LoginForm</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">RegisterForm</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./RegisterForm</span><span class="dl">'</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">data</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">signIn</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">transition</span><span class="p">:</span> <span class="kc">false</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">components</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">LoginForm</span><span class="p">,</span>
    <span class="nx">RegisterForm</span>
  <span class="p">},</span>
  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>
</code></pre></div></div>

<h3 id="vuex-状态管理">Vuex 状态管理</h3>

<p>在构建 Vue 单页面应用时，Vuex 为我们提供了全局状态管理。在 state 中定义的数据后，我们可以在项目中任一个组件中进行获取或修改，并且你的修改可以得到全局的相应变更。当我们想要在项目中定义和使用全局变量时，使用 Vuex 是一个很好的解决方法。</p>

<ul>
  <li>state：对数据的全局存储</li>
  <li>getter：和 Vue计算属性 computed 一样，来实时监听 state 值的变化 (最新状态)</li>
  <li>mutations：对数据的同步更改</li>
  <li>actions：对数据的异步更改</li>
</ul>

<p>Vuex:</p>

<p><img src="/styles/images/7.7/vuex.png" alt="vuex" /></p>

<p>在 src/vuex/store.js 中：</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">vue</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">Vuex</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">vuex</span><span class="dl">'</span>

<span class="k">import</span> <span class="nx">logo</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@/assets/images/niffler-logo.png</span><span class="dl">'</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">Vuex</span><span class="p">)</span>

<span class="c1">// 要设置的全局访问的state对象</span>
<span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// 要设置的初始属性值</span>
  <span class="na">isCollapse</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="na">sysname</span><span class="p">:</span> <span class="dl">'</span><span class="s1">NIFFLER</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="c1">// 实时监听state值的变化(最新状态)</span>
<span class="kd">const</span> <span class="nx">getters</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// 承载变化的isCollapse的值</span>
  <span class="nx">getIsCollapse</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">isCollapse</span>
  <span class="p">},</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="c1">// mutations: 对数据的同步更改</span>
<span class="kd">const</span> <span class="nx">mutations</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">mutationsChangeSideBar</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">state</span><span class="p">.</span><span class="nx">isCollapse</span> <span class="o">=</span> <span class="o">!</span><span class="nx">state</span><span class="p">.</span><span class="nx">isCollapse</span>
  <span class="p">},</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="c1">// actions: 对数据的异步更改</span>
<span class="kd">const</span> <span class="nx">actions</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">changeSideBar</span> <span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">'</span><span class="s1">mutationsChangeSideBar</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vuex</span><span class="p">.</span><span class="nx">Store</span><span class="p">({</span>
  <span class="nx">state</span><span class="p">,</span>
  <span class="nx">getters</span><span class="p">,</span>
  <span class="nx">mutations</span><span class="p">,</span>
  <span class="nx">actions</span>
<span class="p">})</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">store</span>
</code></pre></div></div>

<h3 id="element-ui-组件库">Element-UI 组件库</h3>

<p>Element-UI 是一套基于 Vue 2.x 的组件库， 它提供了构建常见网站的的各种组件，如页面布局、按钮、表单、数据表格、导航菜单、对话框等。使用 Element-UI 能够快速构建一个单页面应用网站。</p>

<p>如在 LoginForm.vue 中使用 Element-UI 实现登录表单：</p>

<div class="language-vue highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;el-form</span> <span class="na">v-if=</span><span class="s">"isRememberPW"</span> <span class="na">:model=</span><span class="s">"ruleForm"</span> <span class="na">status-icon</span> <span class="na">:rules=</span><span class="s">"rules"</span> <span class="na">ref=</span><span class="s">"ruleForm"</span> <span class="na">class=</span><span class="s">"demo-ruleForm"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;el-form-item</span> <span class="na">prop=</span><span class="s">"email"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;el-input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">v-model=</span><span class="s">"ruleForm.email"</span> <span class="na">placeholder=</span><span class="s">"Email"</span><span class="nt">&gt;&lt;/el-input&gt;</span>
  <span class="nt">&lt;/el-form-item&gt;</span>
  <span class="nt">&lt;el-form-item</span> <span class="na">prop=</span><span class="s">"password"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;el-input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">show-password</span> <span class="na">v-model=</span><span class="s">"ruleForm.password"</span> <span class="na">placeholder=</span><span class="s">"Password"</span><span class="nt">&gt;&lt;/el-input&gt;</span>
  <span class="nt">&lt;/el-form-item&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"link"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/#/login"</span> <span class="err">@</span><span class="na">click=</span><span class="s">"isRememberPW = true"</span><span class="nt">&gt;</span>忘记密码?<span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;el-form-item</span> <span class="na">style=</span><span class="s">"width:100%"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;el-button</span>
    <span class="na">:loading=</span><span class="s">"logining"</span>
    <span class="err">@</span><span class="na">click</span><span class="err">.</span><span class="na">native</span><span class="err">.</span><span class="na">prevent=</span><span class="s">"handleLogin"</span>
    <span class="na">type=</span><span class="s">"primary"</span> <span class="na">class=</span><span class="s">"form-btn"</span><span class="nt">&gt;</span>Sign in<span class="nt">&lt;/el-button&gt;</span>
  <span class="nt">&lt;/el-form-item&gt;</span>
<span class="nt">&lt;/el-form&gt;</span>
</code></pre></div></div>

<h3 id="webpack">webpack</h3>

<p>通常，我们在构建网页应用时，会有繁杂的 JavaScript 代码和一大堆依赖包。简单来说，webpack 可以看做是模块打包机，它帮助分析项目结构，把项目的所有依赖文件打包成一个或多个浏览器可以识别的 JavaScript 文件。选择 webpack 来构建我们的应用能够方便管理、开发与部署。</p>

<h3 id="前端文件结构">前端文件结构</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src
│   App.vue			<span class="c"># 程序入口</span>
│   main.js			<span class="c"># main</span>
│   utils.js		<span class="c"># 一些函数</span>
│
├───api				  <span class="c"># axois api接口</span>
│       api.js 			
│       index.js
│
├───assets			<span class="c"># 资源文件</span>
│
├───mock 			  <span class="c"># mock桩测试代码</span>
│
├───page			  <span class="c"># 组件</span>
│   │   404.vue		    <span class="c"># 404页面</span>
│   │   Root.vue 	    <span class="c"># 根页面，包含header</span>
│   │
│   ├───Balance		    <span class="c"># 充值与提现界面</span>
│   │       Balance.vue
│   │
│   ├───components	  <span class="c"># 应用组件</span>
│   │       EditQuestionair.vue		        <span class="c"># 编辑问卷组件</span>
│   │       ModuleCards.vue			          <span class="c"># 模块卡组件</span>
│   │       PageHead.vue			            <span class="c"># 页头组件</span>
│   │       ShowQuestionnaire.vue	        <span class="c"># 显示问卷组件</span>
│   │
│   ├───Errand		    <span class="c"># 跑腿办事页面</span>
│   │       Errand.vue				            <span class="c"># 跑腿办事主页主组件</span>
│   │       Create.vue				            <span class="c"># 创建任务组件子组件</span>
│   │       Mine.vue				              <span class="c"># 我的任务组件子组件</span>
│   │
│   ├───Home		      <span class="c"># 主页面</span>
│   │       Home.vue			                <span class="c"># 主页面主组件</span>
│   │       Message.vue				            <span class="c"># 我的信息子组件</span>
│   │       PersonInfo.vue		            <span class="c"># 个人信息子组件</span>
│   │
│   ├───Login		      <span class="c"># 登录/注册页面</span>
│   │       Login.vue				              <span class="c"># 登录/注册页面主组件</span>
│   │       LoginForm.vue		              <span class="c"># 登录表单子组件</span>
│   │       RegisterForm.vue		          <span class="c"># 注册表单子组件</span>
│   │
│   └───Questionnaire	  <span class="c"># 问卷系统页面</span>
│           Questionnaire.vue		          <span class="c"># 问卷系统主组件</span>
│           Create.vue				            <span class="c"># 创建问卷子组件</span>
│           Mine.vue				              <span class="c"># 我的问卷子组件</span>
│
├───router		<span class="c"># 路由</span>
│       index.js
│
├───styles		<span class="c"># 组件用到的样式（可复用）</span>
│       pages.scss
│       vars.scss
│
└───vuex		  <span class="c"># vuex状态管理</span>
        store.js
</code></pre></div></div>

<hr />

<h2 id="后端设计">后端设计</h2>

<h3 id="模块划分">模块划分</h3>

<p>后端同样使用 MVC 架构，其中 Model 可以用来与数据库交互， 具体如下：</p>

<ul>
  <li>User（Django 自建用户）</li>
  <li>Profile （扩展的用户资料）</li>
  <li>EmailVerify （负责存储邮箱验证码和有效期）</li>
  <li>Task（”问卷” 或 “跑腿” 任务）</li>
  <li>Participantship（用户参与信息）</li>
  <li>Tag（”用户” 或 “任务” 的标签）</li>
</ul>

<p>建立好实体了，接着就需要多功能进行模块划分，划分的好处是让系统结构更加清晰，模块和模块之前相互解耦。同时对于多人协作的项目来说，可以独立分配一个模块进行开发。</p>

<p>其中设计的模块有：</p>

<ul>
  <li>权限管理模块（包括用户的注册登录登出）</li>
  <li>内容模块（包括查看个人资料和当前进行中的所有任务）</li>
  <li>功能模块（包括 “问卷” “跑腿” “充值/提现” 三大功能）</li>
  <li>发布模块（包括修改个人资料，创建问卷，发起委托，参与任务等）</li>
  <li>评论模块（包括发布者取消和确认任务，参与者提出争议和评论问卷等）</li>
</ul>

<p><img src="/styles/images/7.7/django-mvt.png" alt="django-mvt" /></p>

<p>后端此次没有使用模版文件代表的 View，所以没有图形显示界面，对外显示的功能体现为对前端请求的响应。当前端请求到来时，路由模块调用（Controller）提供的接口，即 url.py 中的各种访问入口，进入 views.py 中不同的处理函数，并且在其中通过 model 与数据库交互，之后响应请求返回给用户。</p>

<hr />

<h3 id="软件设计技术">软件设计技术</h3>

<h4 id="命令模式">命令模式</h4>

<p>在软件系统中，“行为请求者”与“行为实现者”通常呈现一种“紧耦合”。但在某些场合，比如要对行为进行“记录、撤销/重做、事务”等处理，这种无法抵御变化的紧耦合是不合适的。在这种情况下，如何将“行为请求者”与“行为实现者”解耦？将一组行为抽象为对象，实现二者之间的松耦合，这就是命令模式（Command Pattern）。</p>

<p>在 Django 中，把 get和 post 这些请求的行为抽象成一个 HttpRequest 类，我们可以通过 request 实例的method 获取行为的类型：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'GET'</span><span class="p">:</span>
    <span class="n">do_something</span><span class="p">()</span>
<span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
    <span class="n">do_something_else</span><span class="p">()</span>
</code></pre></div></div>

<p>此外，对于不同的数据，Django 还分别抽象了相应的类来处理。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Json数据：</span>
from django.http import JsonResponse
<span class="o">&gt;&gt;&gt;</span> response <span class="o">=</span> JsonResponse<span class="o">({</span><span class="s1">'foo'</span>: <span class="s1">'bar'</span><span class="o">})</span>
<span class="o">&gt;&gt;&gt;</span> response.content
b<span class="s1">'{"foo": "bar"}'</span>

<span class="c"># File数据：</span>
from django.http import FileResponse
<span class="o">&gt;&gt;&gt;</span> response <span class="o">=</span> FileResponse<span class="o">(</span>open<span class="o">(</span><span class="s1">'myfile.png'</span>, <span class="s1">'rb'</span><span class="o">))</span>
</code></pre></div></div>

<hr />

<h4 id="观察者模式">观察者模式</h4>

<p>观察者模式（有时又被称为发布（publish）-订阅（Subscribe）模式）是软件设计模式的一种。在此种模式中，一个目标物件管理所有相依于它的观察者物件，并且在它本身的状态改变时主动发出通知。这通常透过呼叫各观察者所提供的方法来实现。此种模式通常被用来实现事件处理系统。</p>

<p>Django 中，存在 Singal 与 dispatch 类，分别用来发送和接受信号，实现被观察与观察者的角色。</p>

<p>定义一个观察者，接收一种特定的信号：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">django.dispatch</span>
 
<span class="n">pizza_done</span> <span class="o">=</span> <span class="n">django</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s">"toppings"</span><span class="p">,</span> <span class="s">"size"</span><span class="p">]</span>
</code></pre></div></div>

<p>发送信号，使观察者接收相应的信息：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PizzaStore</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="o">...</span>
 
    <span class="k">def</span> <span class="nf">send_pizza</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">toppings</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="n">pizza_done</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">toppings</span><span class="o">=</span><span class="n">toppings</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h4 id="restful-设计">RESTful 设计</h4>

<p>在 Django Restframework 框架中的 APIView 类中，提供了put(), delete(), patch() 方法的支持。</p>

<p>如上传一个文件，对应的 view：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FileUploadView</span><span class="p">(</span><span class="n">views</span><span class="o">.</span><span class="n">APIView</span><span class="p">):</span>
    <span class="n">parser_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">FileUploadParser</span><span class="p">,)</span>
 
    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">file_obj</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">'file'</span><span class="p">]</span>
        <span class="c1"># ...
</span>        <span class="c1"># do some stuff with uploaded file
</span>        <span class="c1"># ...
</span>        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">204</span><span class="p">)</span>
</code></pre></div></div>

<p>可以针对每一个 model 定义一个 View 类，并根据不同的请求方法开发不同的处理函数。</p>

<p><img src="/styles/images/7.7/restful.png" alt="django-mvt" /></p>

<p>如本次的 <code class="highlighter-rouge">TaskView</code> 继承自 <code class="highlighter-rouge">ViewSet</code>，<code class="highlighter-rouge">ViewSet</code> 在最后的实例化时，会将 list, create 等方法绑定到 get, post, put, patch, delete 等 REST 操作对应的处理函数（通常由 <code class="highlighter-rouge">Router</code> 创建 URL 定义时自动绑定），最后绑定到 model-list, model-create, model-detail 等 URL。</p>

<p>同样也可以手动 ViewSet 绑定到 URL：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">path</span><span class="p">(</span><span class="s">'task/&lt;pk&gt;/'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">TaskView</span><span class="o">.</span><span class="n">as_view</span><span class="p">({</span><span class="s">'get'</span><span class="p">:</span> <span class="s">'retrieve'</span><span class="p">})),</span>
<span class="n">path</span><span class="p">(</span><span class="s">'task/'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">TaskView</span><span class="o">.</span><span class="n">as_view</span><span class="p">({</span>
  <span class="s">'get'</span><span class="p">:</span> <span class="s">'get'</span><span class="p">,</span>
  <span class="s">'post'</span><span class="p">:</span> <span class="s">'create'</span>
  <span class="p">})),</span>
<span class="n">path</span><span class="p">(</span><span class="s">'task/cancel/&lt;pk&gt;/'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">TaskView</span><span class="o">.</span><span class="n">as_view</span><span class="p">({</span><span class="s">'post'</span><span class="p">:</span> <span class="s">'cancel'</span><span class="p">})),</span>
<span class="n">path</span><span class="p">(</span><span class="s">'task/claim/&lt;pk&gt;/'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">TaskView</span><span class="o">.</span><span class="n">as_view</span><span class="p">({</span><span class="s">'post'</span><span class="p">:</span> <span class="s">'claim'</span><span class="p">})),</span>
</code></pre></div></div>

<hr />

<h4 id="面向对象设计">面向对象设计</h4>

<p>面向对象程序设计是一种程序设计范型，也是一种程序开发的方法。把对象作为程序的基本单元，将程序和数据封装其中，以此来提高软件的重用性、灵活性、和扩展性。面向对象设计可以看做是一种在程序中包含各种独立而又相互调用的对象的思想，这与传统的思想不同，传统的思想更侧重于把程序看作一系列函数的集合，而面向对象设计中的每一个对象都能够接收数据、处理数据和把数据传达给其他对象。</p>

<p>在后端开发中，我们使用了ORM，ORM全称是Object Relational Mapping（对象关系映射)，它在编程中把面向对象的概念跟数据库中表的概念对应起来，定义一个对象，就对应着一张表，这个对象的实例，就对应着表中的一条记录。ORM封装了底层的数据库操作，降低了编程难度，提高了代码的可读性和易维护性。</p>

<p>在模型<a href="https://github.com/sysu-swsad-team/niffler-backend/blob/master/niffler/questionnaire/models.py">niffler-backend/niffler/questionnaire/models.py</a>中，我们定义了EmailVerify、Profile、Task等等几个类，这些类继承了django.db.models.Model，这些类定义了数据库的行为，每个类在数据库中都有一张表，我们在类中定义了一些属性，这些属性对应了表的不同字段，同时我们也在类中定义一些方法，让这些类不仅有数据库的存储和查询功能，还能进行一些计算，比如<a href="https://github.com/sysu-swsad-team/niffler-backend/blob/master/niffler/questionnaire/models.py#L142">Task.status</a>这种计算属性，使得这个计算行为只存在模型中，而对视图和控制器是透明的，很好地揭藕，有利于扩展、移植和维护。</p>

<p>在视图<a href="https://github.com/sysu-swsad-team/niffler-backend/blob/master/niffler/questionnaire/views.py">niffler-backend/niffler/questionnaire/views.py</a>中，我们根据<a href="https://github.com/sysu-swsad-team/niffler-backend/blob/master/niffler/questionnaire/models.py">niffler-backend/niffler/questionnaire/models.py</a>的类定义相应的视图集（也是一个类，继承了rest_framework.viewsets.ViewSet），比如<a href="https://github.com/sysu-swsad-team/niffler-backend/blob/master/niffler/questionnaire/views.py#L740">ProfileView</a>。对于一个视图集，我们可以重载rest_framework.viewsets.ViewSet的一些属性，如用于验证的<a href="https://github.com/sysu-swsad-team/niffler-backend/blob/master/niffler/questionnaire/views.py#L741">authentication_classes</a>，我们也定义了一些方法，比如<a href="https://github.com/sysu-swsad-team/niffler-backend/blob/master/niffler/questionnaire/views.py#L745">retrieve()</a>，<a href="https://github.com/sysu-swsad-team/niffler-backend/blob/master/niffler/questionnaire/views.py#L764">get()</a>，<a href="https://github.com/sysu-swsad-team/niffler-backend/blob/master/niffler/questionnaire/views.py#L785">post()</a>，对应不同的服务操作，而模型的不同类都会有retrieve、get、post这种相似的操作，相比将所有操作写成并列的视图函数这种做法，面向对象使得编程结构更加简洁和清晰，代码更具可读性，增删方法也更加灵活，也能够复用类似authentication_classes的相同属性，增加内聚性。</p>

            </article>
        </div>
      </div>
    </div>
  </div>
</div>

    
    <footer class="footer" role="contentinfo">
	<div class="container">
		<p class="copyright">Copyright &copy; 2019-2019 <a href="https://sysu-swsad-team.github.io/"><code>sysu-swsad-team</code></a>.</p>
		<p>Powered by <a href="http://jekyllrb.com">Jekyll</a>, themed from <a href="http://lesscss.cn/">Less</a>, refactored by <a href="http://www.hifreud.com/">Freud Kang</a></p>
	</div>
</footer>

<script src="/styles/js/jquery.min.js"></script>
<script src="/styles/js/bootstrap.min.js"></script>
<script src="/styles/js/holder.min.js"></script>
<script src="/styles/js/lessismore.js"></script>
<script src="/styles/js/application.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  </body>
</html>
